{% extends "base.html" %}

{% block content %}

	<div class="container border bg-light my-1">
		<h6 class="text-secondary text-right">Заявка<h6>
		{% if current_user.role.name == 'initiative' %}
			<div class="row">
				<div class="col text-right">
					<a class="btn btn-danger btn-sm" href="{{ url_for('main.DeleteOrder', order_id = order['orderNumber']) }}">Удалить</a>
				</div>
			</div>
		{% endif %}
		<div class="row my-1 d-none d-sm-flex font-weight-bold">
			<div class="col overflow-hidden">
				Номер
			</div>
			<div class="col overflow-hidden">
				Дата
			</div>
			<div class="col overflow-hidden">
				Инициатор
			</div>
			{% if current_user.role.name == 'approver' %}
				<div class="col overflow-hidden">
					Согласование
				</div>
			{% endif %}
		</div>
		{% include '_order.html' %}
	</div>

	<div class="container border bg-light my-1">
		<h6 class="text-secondary text-right">Товары</h6>
		<div class="row my-1 d-none d-sm-flex font-weight-bold">
			<div class="col overflow-hidden">
				Название
			</div>
			<div class="col overflow-hidden">
				Артикул
			</div>
			<div class="col overflow-hidden">
				Цена
			</div>
			<div class="col overflow-hidden">
				Количество
			</div>
			<div class="col overflow-hidden">
				Изображение
			</div>
			{% if current_user.role.name != 'initiative' %}
				<div class="col">
					Отклонить
				</div>
			{% endif %}
		</div>
		{% for product in order['items'] %}
			{% include '_product.html' %}
		{% endfor %}
	</div>
	{% if approvals|length > 0 %}
		<div class="container border bg-light my-1">
			<h6 class="text-secondary text-right">Согласования</h6>
			{% for approval in approvals %}
				<div class="row border-bottom my-1">
					<div class="col-sm font-weight-bold">
						{% if approval.user.name %}
							{{ approval.user.name }}
						{% else %}
							{{ approval.user.email }}
						{% endif %}
					</div>
					<div class="col-sm">
						{% if approval.product_id %}
							<div class="alert alert-danger" role="alert">
								отклонил товар
								{{ approval.product_sku }}
							</div>
						{% else %}
							<div class="alert alert-success" role="alert">
								одобрил заявку
							</div>
						{% endif %}
					</div>
				</div>
			{% endfor %}
		</div>
	{% endif %}
	{% if comments|length > 0 %}
		<div class="container border bg-light my-1">
			<h6 class="text-secondary text-right">Комментарии</h6>
			{% for comment in comments %}
				<div class="row border-bottom my-1">
					<div class="col-sm font-weight-bold">
						{% if comment.user.name %}
							{{ comment.user.name }}
						{% else %}
							{{ comment.user.email }}
						{% endif %}
					</div>
					<div class="col-sm">
						<div class="alert alert-primary" role="alert">
							{{ comment.comment }}
						</div>
					</div>
				</div>
			{% endfor %}
		</div>
	{% endif %}
	<div class="container border bg-light my-1 py-2">
		<div class = "row my-1">
			<div class="col">
				{% set errorsList = comment_form.comment.errors %}
				{% if errorsList|length > 0 %}
					<div class="alert alert-danger" role="alert">
						{% for error in  errorsList %}
							{{ error }}<br>
						{% endfor %}
					</div>
				{% endif %}
			</div>
		</div>
		<form action="{{ url_for('main.SaveComment', order_id = order['orderNumber']) }}" method="post">
			{{ comment_form.csrf_token }}
			<div class="form-group row">
				{{ comment_form.comment.label(class_ = "col-md-2 col-form-label") }}
				<div class="col-md-10">
					{{ comment_form.comment(class_ = 'form-control', autofocus = '') }}
				</div>
			</div>
			<div class="form-group row">
				<div class="col">
					{{ comment_form.submit(class_ = 'btn btn-primary mb-1') }}
				</div>
			</div>
		</form>
	</div>	

{% endblock %}

{% block scripts %}

<script>
	$(document).ready(function(){
		//Scripts
	});
</script>
{%endblock %}